<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Material - Edutop Scholars</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #311b92;
            --primary-light: #4527a0;
            --secondary: #ff5722;
            --accent: #00bcd4;
            --light: #f5f5f7;
            --dark: #333;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --gray: #777;
            --light-gray: #eee;
        }
        
        body {
            background: var(--light);
            color: var(--dark);
            min-height: 100vh;
        }
        
        .header {
            background: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo h1 {
            color: var(--primary);
            font-size: 28px;
        }
        
        .logo span {
            color: var(--secondary);
        }
        
        .back-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }
        
        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .resource-detail {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .resource-cover {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }
        
        .resource-header {
            padding: 30px;
            border-bottom: 2px solid var(--light-gray);
        }
        
        .resource-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray);
            font-size: 14px;
        }
        
        .resource-category {
            display: inline-block;
            padding: 8px 20px;
            background: rgba(49, 27, 146, 0.1);
            color: var(--primary);
            border-radius: 20px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .resource-title {
            color: var(--primary);
            font-size: 32px;
            margin-bottom: 15px;
            line-height: 1.3;
        }
        
        .resource-description {
            color: var(--gray);
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .resource-content {
            padding: 30px;
        }
        
        .content-section {
            margin-bottom: 40px;
        }
        
        .section-title {
            color: var(--primary);
            font-size: 24px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-gray);
        }
        
        .content-text {
            line-height: 1.8;
            margin-bottom: 20px;
        }
        
        .content-text p {
            margin-bottom: 15px;
        }
        
        .content-image {
            width: 100%;
            max-width: 600px;
            border-radius: 10px;
            margin: 20px auto;
            display: block;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid var(--light-gray);
        }
        
        .btn {
            padding: 12px 25px;
            border-radius: 50px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-light);
        }
        
        .btn-secondary {
            background: var(--light-gray);
            color: var(--dark);
        }
        
        .related-resources {
            margin-top: 60px;
        }
        
        .related-title {
            color: var(--primary);
            font-size: 24px;
            margin-bottom: 25px;
        }
        
        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .related-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .related-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .related-category {
            display: inline-block;
            padding: 5px 15px;
            background: rgba(49, 27, 146, 0.1);
            color: var(--primary);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .related-name {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .reading-progress {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            min-width: 200px;
            display: none;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
            color: var(--gray);
        }
        
        .progress-bar {
            height: 8px;
            background: var(--light-gray);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s;
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .resource-title {
                font-size: 24px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .related-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <h1>Edutop<span>Scholars</span></h1>
        </div>
        <button class="back-btn" onclick="window.history.back()">
            <i class="fas fa-arrow-left"></i>
            Back to Materials
        </button>
    </header>

    <div class="container">
        <div class="resource-detail">
            <img src="" alt="Resource Cover" class="resource-cover" id="resourceCover">
            
            <div class="resource-header">
                <div class="resource-meta" id="resourceMeta">
                    <!-- Meta data will be loaded here -->
                </div>
                <div class="resource-category" id="resourceCategory">Loading...</div>
                <h1 class="resource-title" id="resourceTitle">Loading...</h1>
                <p class="resource-description" id="resourceDescription">Loading description...</p>
            </div>
            
            <div class="resource-content" id="resourceContent">
                <!-- Content will be loaded here -->
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="markAsCompleted()">
                    <i class="fas fa-check-circle"></i> Mark as Completed
                </button>
                <button class="btn btn-secondary" onclick="downloadResource()">
                    <i class="fas fa-download"></i> Download PDF
                </button>
                <button class="btn btn-secondary" onclick="shareResource()">
                    <i class="fas fa-share-alt"></i> Share
                </button>
            </div>
        </div>
        
        <div class="related-resources">
            <h2 class="related-title">Related Materials</h2>
            <div class="related-grid" id="relatedResources">
                <!-- Related resources will be loaded here -->
            </div>
        </div>
    </div>
    
    <div class="reading-progress" id="readingProgress">
        <div class="progress-header">
            <span>Reading Progress</span>
            <span id="progressPercentage">0%</span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { getFirestore, doc, updateDoc, arrayUnion, increment } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyCictHNxtslYs9VR0hoicxlwPn_QghkgIA",
            authDomain: "edutop-7ff51.firebaseapp.com",
            projectId: "edutop-7ff51",
            storageBucket: "edutop-7ff51.firebasestorage.app",
            messagingSenderId: "79307850494",
            appId: "1:79307850494:web:b51ce51204140ec5429baf",
            measurementId: "G-GGGH590BYS"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Sample resource data
        const resources = {
            1: {
                title: "JAMB English Language Complete Guide 2026",
                description: "Comprehensive guide covering comprehension, lexis, structure, and oral English. Includes 500+ practice questions with detailed explanations.",
                category: "English",
                author: "Edutop Scholars Team",
                pages: 250,
                readTime: "8 hours",
                difficulty: "Intermediate",
                image: "https://images.unsplash.com/photo-1501504905252-473c47e087f8?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=800&q=80",
                content: `
                    <div class="content-section">
                        <h2 class="section-title">Introduction to JAMB English</h2>
                        <div class="content-text">
                            <p>The Joint Admissions and Matriculation Board (JAMB) English Language examination tests your proficiency in English as it's used in academic and formal contexts. This guide covers all aspects of the exam to help you achieve excellence.</p>
                            
                            <h3 style="color: var(--primary); margin: 20px 0 10px 0;">Exam Structure</h3>
                            <ul style="padding-left: 20px; margin-bottom: 15px;">
                                <li style="margin-bottom: 8px;">Section A: Comprehension/Summary - 40%</li>
                                <li style="margin-bottom: 8px;">Section B: Lexis and Structure - 40%</li>
                                <li style="margin-bottom: 8px;">Section C: Oral Forms - 20%</li>
                            </ul>
                            
                            <p>Each section tests different language skills, from understanding written texts to proper grammatical usage and pronunciation.</p>
                        </div>
                    </div>
                    
                    <div class="content-section">
                        <h2 class="section-title">Comprehension Strategies</h2>
                        <div class="content-text">
                            <p>Reading comprehension requires both understanding the text and answering questions accurately within the time limit.</p>
                            
                            <h4 style="color: var(--primary); margin: 15px 0 10px 0;">Effective Reading Techniques:</h4>
                            <ol style="padding-left: 20px; margin-bottom: 15px;">
                                <li style="margin-bottom: 8px;"><strong>Skimming:</strong> Quickly read to get the main idea</li>
                                <li style="margin-bottom: 8px;"><strong>Scanning:</strong> Look for specific information</li>
                                <li style="margin-bottom: 8px;"><strong>Close Reading:</strong> Read carefully for details</li>
                                <li style="margin-bottom: 8px;"><strong>Inferential Reading:</strong> Read between the lines</li>
                            </ol>
                        </div>
                    </div>
                `
            }
        };

        document.addEventListener('DOMContentLoaded', async function() {
            // Get resource ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const resourceId = parseInt(urlParams.get('id')) || 1;
            
            // Check auth
            onAuthStateChanged(auth, async (user) => {
                if (!user) {
                    window.location.href = "index.html";
                    return;
                }
                
                await loadResource(resourceId);
                loadRelatedResources(resourceId);
                setupReadingProgress();
            });
        });

        async function loadResource(id) {
            const resource = resources[id] || resources[1];
            
            // Update UI
            document.getElementById('resourceCover').src = resource.image;
            document.getElementById('resourceCategory').textContent = resource.category;
            document.getElementById('resourceTitle').textContent = resource.title;
            document.getElementById('resourceDescription').textContent = resource.description;
            
            // Update meta data
            const metaHtml = `
                <div class="meta-item">
                    <i class="far fa-user"></i>
                    <span>${resource.author}</span>
                </div>
                <div class="meta-item">
                    <i class="far fa-clock"></i>
                    <span>${resource.readTime}</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-file-alt"></i>
                    <span>${resource.pages} pages</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-chart-line"></i>
                    <span>${resource.difficulty}</span>
                </div>
            `;
            document.getElementById('resourceMeta').innerHTML = metaHtml;
            
            // Update content
            document.getElementById('resourceContent').innerHTML = resource.content;
            
            // Track view
            await trackResourceView(id, resource.title, resource.category);
        }

        function loadRelatedResources(currentId) {
            const relatedContainer = document.getElementById('relatedResources');
            relatedContainer.innerHTML = '';
            
            // Get related resources (excluding current)
            Object.entries(resources).forEach(([id, resource]) => {
                if (parseInt(id) !== currentId) {
                    const card = document.createElement('div');
                    card.className = 'related-card';
                    card.onclick = () => window.location.href = `resource-detail.html?id=${id}`;
                    
                    card.innerHTML = `
                        <div class="related-category">${resource.category}</div>
                        <h3 class="related-name">${resource.title}</h3>
                        <p style="color: var(--gray); font-size: 14px; margin-bottom: 15px;">${resource.description.substring(0, 100)}...</p>
                        <div style="display: flex; justify-content: space-between; font-size: 14px; color: var(--gray);">
                            <span><i class="far fa-clock"></i> ${resource.readTime}</span>
                            <span><i class="fas fa-file-alt"></i> ${resource.pages} pages</span>
                        </div>
                    `;
                    
                    relatedContainer.appendChild(card);
                }
            });
        }

        async function trackResourceView(id, title, category) {
            try {
                const userRef = doc(db, "users", auth.currentUser.uid);
                const viewData = {
                    id: id,
                    title: title,
                    category: category,
                    timestamp: new Date().toISOString(),
                    page: 'detail'
                };
                
                await updateDoc(userRef, {
                    recentlyViewed: arrayUnion(viewData),
                    [`readingProgress.viewedMaterials.${id}`]: {
                        lastViewed: new Date().toISOString(),
                        viewedCount: increment(1),
                        completed: false
                    },
                    'stats.studyHours': increment(0.1)
                });
                
            } catch (error) {
                console.error('Error tracking resource view:', error);
            }
        }

        async function markAsCompleted() {
            const urlParams = new URLSearchParams(window.location.search);
            const resourceId = parseInt(urlParams.get('id')) || 1;
            const resource = resources[resourceId] || resources[1];
            
            try {
                const userRef = doc(db, "users", auth.currentUser.uid);
                
                await updateDoc(userRef, {
                    [`readingProgress.viewedMaterials.${resourceId}.completed`]: true,
                    [`readingProgress.viewedMaterials.${resourceId}.completedAt`]: new Date().toISOString(),
                    'stats.studyHours': increment(0.5)
                });
                
                alert(`"${resource.title}" marked as completed! Great work!`);
                
            } catch (error) {
                console.error('Error marking as completed:', error);
                alert('Failed to mark as completed: ' + error.message);
            }
        }

        function downloadResource() {
            const urlParams = new URLSearchParams(window.location.search);
            const resourceId = parseInt(urlParams.get('id')) || 1;
            const resource = resources[resourceId] || resources[1];
            
            alert(`Downloading "${resource.title}"...\n\nIn the full version, this would download a PDF file.`);
            
            // In a real app, this would trigger a file download
            // For demo, we'll create a simple text file
            const content = `
                ${resource.title}
                ${resource.category}
                ${resource.description}
                
                Download Date: ${new Date().toLocaleDateString()}
                
                This is a demo download. In the full version, you would receive the complete study material.
            `;
            
            const blob = new Blob([content], {type: 'text/plain'});
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `edutop-${resource.title.replace(/\s+/g, '-').toLowerCase()}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function shareResource() {
            const urlParams = new URLSearchParams(window.location.search);
            const resourceId = parseInt(urlParams.get('id')) || 1;
            const resource = resources[resourceId] || resources[1];
            
            const shareText = `Check out "${resource.title}" on Edutop Scholars - ${window.location.href}`;
            
            if (navigator.share) {
                navigator.share({
                    title: resource.title,
                    text: resource.description.substring(0, 100),
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(shareText);
                alert('Link copied to clipboard!');
            }
        }

        function setupReadingProgress() {
            const progressElement = document.getElementById('readingProgress');
            const progressFill = document.getElementById('progressFill');
            const progressPercentage = document.getElementById('progressPercentage');
            
            let progress = 0;
            
            // Show progress indicator
            setTimeout(() => {
                progressElement.style.display = 'block';
            }, 1000);
            
            // Simulate reading progress
            const progressInterval = setInterval(() => {
                if (progress < 100) {
                    progress += 0.5;
                    progressFill.style.width = `${progress}%`;
                    progressPercentage.textContent = `${Math.round(progress)}%`;
                } else {
                    clearInterval(progressInterval);
                }
            }, 100);
            
            // Update progress on scroll
            window.addEventListener('scroll', () => {
                const scrolled = (window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100;
                if (scrolled > progress) {
                    progress = Math.min(scrolled, 100);
                    progressFill.style.width = `${progress}%`;
                    progressPercentage.textContent = `${Math.round(progress)}%`;
                }
            });
        }

    </script>
</body>
</html>

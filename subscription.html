<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subscription - Edutop Scholars</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #311b92;
            --primary-light: #4527a0;
            --secondary: #ff5722;
            --accent: #00bcd4;
            --light: #f5f5f7;
            --dark: #333;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --gray: #777;
            --light-gray: #eee;
            --dark-bg: #121212;
            --dark-card: #1e1e1e;
            --dark-text: #ffffff;
        }
        
        body {
            background: var(--light);
            color: var(--dark);
            min-height: 100vh;
            transition: background 0.3s, color 0.3s;
        }
        
        body.dark-mode {
            background: var(--dark-bg);
            color: var(--dark-text);
        }
        
        .header {
            background: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        body.dark-mode .header {
            background: var(--dark-card);
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo h1 {
            color: var(--primary);
            font-size: 28px;
        }
        
        .logo span {
            color: var(--secondary);
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
        }
        
        .nav-link {
            color: var(--dark);
            text-decoration: none;
            font-weight: 500;
            padding: 8px 15px;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        body.dark-mode .nav-link {
            color: var(--dark-text);
        }
        
        .nav-link:hover {
            background: rgba(49, 27, 146, 0.1);
        }
        
        .nav-link.active {
            background: var(--primary);
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .page-header h1 {
            color: var(--primary);
            font-size: 36px;
            margin-bottom: 10px;
        }
        
        body.dark-mode .page-header h1 {
            color: #bb86fc;
        }
        
        .current-plan {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 40px;
            text-align: center;
        }
        
        body.dark-mode .current-plan {
            background: linear-gradient(135deg, #bb86fc 0%, #3700b3 100%);
        }
        
        .plan-badge {
            display: inline-block;
            padding: 8px 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .current-plan h2 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .plan-details {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .plan-detail-item {
            text-align: center;
        }
        
        .plan-detail-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .plan-detail-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .plans-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .plan-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            position: relative;
            transition: all 0.3s;
        }
        
        body.dark-mode .plan-card {
            background: var(--dark-card);
        }
        
        .plan-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }
        
        .plan-card.popular {
            border: 3px solid var(--primary);
            transform: scale(1.05);
        }
        
        body.dark-mode .plan-card.popular {
            border-color: #bb86fc;
        }
        
        .plan-card.popular:hover {
            transform: scale(1.05) translateY(-10px);
        }
        
        .popular-badge {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: white;
            padding: 8px 25px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 14px;
        }
        
        body.dark-mode .popular-badge {
            background: #bb86fc;
        }
        
        .plan-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .plan-name {
            color: var(--primary);
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        body.dark-mode .plan-name {
            color: #bb86fc;
        }
        
        .plan-price {
            font-size: 48px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        body.dark-mode .plan-price {
            color: #bb86fc;
        }
        
        .plan-period {
            color: var(--gray);
            font-size: 16px;
        }
        
        .plan-features {
            margin: 25px 0;
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 0;
            border-bottom: 1px solid var(--light-gray);
        }
        
        body.dark-mode .feature-item {
            border-color: #333;
        }
        
        .feature-item:last-child {
            border-bottom: none;
        }
        
        .feature-icon {
            color: var(--success);
        }
        
        .feature-icon.disabled {
            color: var(--gray);
        }
        
        .feature-text {
            flex: 1;
        }
        
        .feature-text.disabled {
            color: var(--gray);
            text-decoration: line-through;
        }
        
        .plan-btn {
            width: 100%;
            padding: 15px;
            border-radius: 50px;
            border: none;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }
        
        .plan-btn.primary {
            background: var(--primary);
            color: white;
        }
        
        .plan-btn.primary:hover {
            background: var(--primary-light);
            transform: scale(1.05);
        }
        
        .plan-btn.secondary {
            background: var(--light-gray);
            color: var(--dark);
        }
        
        body.dark-mode .plan-btn.secondary {
            background: #333;
            color: var(--dark-text);
        }
        
        .plan-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .payment-methods {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-top: 40px;
        }
        
        body.dark-mode .payment-methods {
            background: var(--dark-card);
        }
        
        .payment-methods h2 {
            color: var(--primary);
            margin-bottom: 20px;
            text-align: center;
        }
        
        body.dark-mode .payment-methods h2 {
            color: #bb86fc;
        }
        
        .methods-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .method-card {
            background: var(--light);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        body.dark-mode .method-card {
            background: #2d2d2d;
        }
        
        .method-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }
        
        .method-card.selected {
            border-color: var(--primary);
            background: rgba(49, 27, 146, 0.1);
        }
        
        body.dark-mode .method-card.selected {
            background: rgba(187, 134, 252, 0.2);
        }
        
        .method-icon {
            font-size: 40px;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .method-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .method-fee {
            font-size: 12px;
            color: var(--gray);
        }
        
        .payment-form {
            margin-top: 30px;
            display: none;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary);
        }
        
        body.dark-mode .form-group label {
            color: #bb86fc;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        body.dark-mode .form-control {
            background: var(--dark-card);
            border-color: #333;
            color: var(--dark-text);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .card-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .form-actions .btn {
            flex: 1;
            padding: 15px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-secondary {
            background: var(--light-gray);
            color: var(--dark);
        }
        
        body.dark-mode .btn-secondary {
            background: #333;
            color: var(--dark-text);
        }
        
        .faq-section {
            margin-top: 60px;
        }
        
        .faq-section h2 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 30px;
        }
        
        body.dark-mode .faq-section h2 {
            color: #bb86fc;
        }
        
        .faq-item {
            background: white;
            border-radius: 10px;
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        body.dark-mode .faq-item {
            background: var(--dark-card);
        }
        
        .faq-question {
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }
        
        .faq-answer {
            padding: 0 20px;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .faq-answer.active {
            padding: 0 20px 20px 20px;
            max-height: 500px;
        }
        
        .faq-icon {
            transition: transform 0.3s;
        }
        
        .faq-item.active .faq-icon {
            transform: rotate(180deg);
        }
        
        @media (max-width: 992px) {
            .plans-container {
                grid-template-columns: 1fr;
            }
            
            .plan-card.popular {
                transform: none;
            }
            
            .plan-card.popular:hover {
                transform: translateY(-10px);
            }
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .card-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <h1>Edutop<span>Scholars</span></h1>
        </div>
        <div class="nav-links">
            <a href="dashboard.html" class="nav-link"><i class="fas fa-home"></i> Dashboard</a>
            <a href="resources.html" class="nav-link"><i class="fas fa-book-open"></i> Study Materials</a>
            <a href="profile.html" class="nav-link"><i class="fas fa-user-circle"></i> Profile</a>
            <a href="subscription.html" class="nav-link active"><i class="fas fa-credit-card"></i> Subscription</a>
        </div>
    </header>

    <div class="container">
        <div class="page-header">
            <h1><i class="fas fa-crown"></i> Upgrade Your Learning</h1>
            <p>Choose the perfect plan to unlock premium features and accelerate your success</p>
        </div>
        
        <div class="current-plan" id="currentPlan">
            <!-- Current plan will be loaded here -->
        </div>
        
        <div class="plans-container">
            <!-- Free Plan -->
            <div class="plan-card">
                <div class="plan-header">
                    <h3 class="plan-name">Free Plan</h3>
                    <div class="plan-price">₦0</div>
                    <div class="plan-period">Forever free</div>
                </div>
                
                <div class="plan-features">
                    <div class="feature-item">
                        <i class="fas fa-check feature-icon"></i>
                        <span class="feature-text">Basic JAMB Practice Questions</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-check feature-icon"></i>
                        <span class="feature-text">Limited Study Materials (50)</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-check feature-icon"></i>
                        <span class="feature-text">Basic Performance Analytics</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-times feature-icon disabled"></i>
                        <span class="feature-text disabled">Unlimited Exam Attempts</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-times feature-icon disabled"></i>
                        <span class="feature-text disabled">Advanced Analytics & Reports</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-times feature-icon disabled"></i>
                        <span class="feature-text disabled">Multiplayer Exam Mode</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-times feature-icon disabled"></i>
                        <span class="feature-text disabled">Private Tutoring Access</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-times feature-icon disabled"></i>
                        <span class="feature-text disabled">Downloadable Materials</span>
                    </div>
                </div>
                
                <button class="plan-btn secondary" id="freePlanBtn" disabled>Current Plan</button>
            </div>
            
            <!-- Monthly Plan -->
            <div class="plan-card">
                <div class="plan-header">
                    <h3 class="plan-name">Monthly Plan</h3>
                    <div class="plan-price">₦6,000</div>
                    <div class="plan-period">per month</div>
                </div>
                
                <div class="plan-features">
                    <div class="feature-item">
                        <i class="fas fa-check feature-icon"></i>
                        <span class="feature-text">All Free Features</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-check feature-icon"></i>
                        <span class="feature-text">Unlimited Exam Attempts</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-check feature-icon"></i>
                        <span class="feature-text">Advanced Analytics & Reports</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-check feature-icon"></i>
                        <span class="feature-text">Multiplayer Exam Mode</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-check feature-icon"></i>
                        <span class="feature-text">Full Study Materials Access</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-times feature-icon disabled"></i>
                        <span class="feature-text disabled">Private Tutoring Access</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-times feature-icon disabled"></i>
                        <span class="feature-text disabled">Priority Support</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-times feature-icon disabled"></i>
                        <span class="feature-text disabled">Download All Materials</span>
                    </div>
                </div>
                
                <button class="plan-btn primary" onclick="selectPlan('monthly', 6000)">Upgrade Now</button>
            </div>
            
            <!-- 3-Month Plan (Most Popular) -->
            <div class="plan-card popular">
                <div class="popular-badge">MOST POPULAR</div>
                <div class="plan-header">
                    <h3 class="plan-name">3-Month Plan</h3>
                    <div class="plan-price">₦16,000</div>
                    <div class="plan-period">every 3 months (Save ₦2,000)</div>
                </div>
                
                <div class="plan-features">
                    <div class="feature-item">
                        <i class="fas fa-check feature-icon"></i>
                        <span class="feature-text">All Monthly Features</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-check feature-icon"></i>
                        <span class="feature-text">Private Tutoring (2 sessions)</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-check feature-icon"></i>
                        <span class="feature-text">Priority Email Support</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-check feature-icon"></i>
                        <span class="feature-text">Download Study Materials</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-check feature-icon"></i>
                        <span class="feature-text">Custom Study Schedule</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-check feature-icon"></i>
                        <span class="feature-text">Progress Reports</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-check feature-icon"></i>
                        <span class="feature-text">Exam Strategy Sessions</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-check feature-icon"></i>
                        <span class="feature-text">Certificate of Completion</span>
                    </div>
                </div>
                
                <button class="plan-btn primary" onclick="selectPlan('3months', 16000)">Get Premium</button>
            </div>
        </div>
        
        <div class="payment-methods">
            <h2><i class="fas fa-credit-card"></i> Select Payment Method</h2>
            
            <div class="methods-grid" id="paymentMethods">
                <div class="method-card" data-method="card" onclick="selectPaymentMethod('card')">
                    <div class="method-icon">
                        <i class="far fa-credit-card"></i>
                    </div>
                    <div class="method-name">Debit/Credit Card</div>
                    <div class="method-fee">No additional fees</div>
                </div>
                
                <div class="method-card" data-method="transfer" onclick="selectPaymentMethod('transfer')">
                    <div class="method-icon">
                        <i class="fas fa-university"></i>
                    </div>
                    <div class="method-name">Bank Transfer</div>
                    <div class="method-fee">No additional fees</div>
                </div>
                
                <div class="method-card" data-method="ussd" onclick="selectPaymentMethod('ussd')">
                    <div class="method-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <div class="method-name">USSD</div>
                    <div class="method-fee">No additional fees</div>
                </div>
                
                <div class="method-card" data-method="wallet" onclick="selectPaymentMethod('wallet')">
                    <div class="method-icon">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div class="method-name">Digital Wallet</div>
                    <div class="method-fee">No additional fees</div>
                </div>
            </div>
            
            <!-- Card Payment Form -->
            <div class="payment-form" id="cardForm">
                <h3 style="color: var(--primary); margin-bottom: 20px;">Enter Card Details</h3>
                
                <div class="form-group">
                    <label for="cardNumber">Card Number</label>
                    <input type="text" id="cardNumber" class="form-control" placeholder="1234 5678 9012 3456" maxlength="19">
                </div>
                
                <div class="card-details">
                    <div class="form-group">
                        <label for="cardExpiry">Expiry Date</label>
                        <input type="text" id="cardExpiry" class="form-control" placeholder="MM/YY" maxlength="5">
                    </div>
                    
                    <div class="form-group">
                        <label for="cardCVC">CVC</label>
                        <input type="text" id="cardCVC" class="form-control" placeholder="123" maxlength="4">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="cardName">Name on Card</label>
                    <input type="text" id="cardName" class="form-control" placeholder="John Doe">
                </div>
                
                <div class="form-actions">
                    <button class="btn-secondary" onclick="cancelPayment()">Cancel</button>
                    <button class="btn-primary" onclick="processPayment()">Pay Now</button>
                </div>
            </div>
            
            <!-- Bank Transfer Form -->
            <div class="payment-form" id="transferForm">
                <h3 style="color: var(--primary); margin-bottom: 20px;">Bank Transfer Details</h3>
                
                <div style="background: var(--light); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="color: var(--primary); margin-bottom: 15px;">Account Details</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <div style="font-size: 12px; color: var(--gray);">Bank Name</div>
                            <div style="font-weight: 600;">Edutop Scholars Bank</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: var(--gray);">Account Number</div>
                            <div style="font-weight: 600; font-family: monospace;">1234567890</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: var(--gray);">Account Name</div>
                            <div style="font-weight: 600;">Edutop Scholars Limited</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: var(--gray);">Amount</div>
                            <div style="font-weight: 600;" id="transferAmount">₦0</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="transferReference">Payment Reference</label>
                    <input type="text" id="transferReference" class="form-control" placeholder="Your name or email">
                    <div style="font-size: 12px; color: var(--gray); margin-top: 5px;">
                        Use this as payment reference
                    </div>
                </div>
                
                <div class="form-actions">
                    <button class="btn-secondary" onclick="cancelPayment()">Cancel</button>
                    <button class="btn-primary" onclick="completeTransfer()">I have transferred</button>
                </div>
            </div>
        </div>
        
        <div class="faq-section">
            <h2><i class="fas fa-question-circle"></i> Frequently Asked Questions</h2>
            
            <div class="faq-item">
                <div class="faq-question" onclick="toggleFAQ(this)">
                    <span>Can I switch plans anytime?</span>
                    <i class="fas fa-chevron-down faq-icon"></i>
                </div>
                <div class="faq-answer">
                    <p>Yes, you can upgrade or downgrade your plan at any time. When upgrading, you'll be charged the prorated difference. When downgrading, changes will take effect at the end of your current billing cycle.</p>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question" onclick="toggleFAQ(this)">
                    <span>Is there a free trial for premium plans?</span>
                    <i class="fas fa-chevron-down faq-icon"></i>
                </div>
                <div class="faq-answer">
                    <p>Yes! All new users get a 7-day free trial of the Monthly Plan features. No credit card required. You can cancel anytime during the trial period without being charged.</p>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question" onclick="toggleFAQ(this)">
                    <span>What payment methods do you accept?</span>
                    <i class="fas fa-chevron-down faq-icon"></i>
                </div>
                <div class="faq-answer">
                    <p>We accept all major debit/credit cards (Visa, MasterCard, Verve), bank transfers, USSD codes, and popular digital wallets like Paystack, Flutterwave, and Monnify.</p>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question" onclick="toggleFAQ(this)">
                    <span>Can I cancel my subscription?</span>
                    <i class="fas fa-chevron-down faq-icon"></i>
                </div>
                <div class="faq-answer">
                    <p>Yes, you can cancel your subscription at any time. Your premium features will remain active until the end of your current billing period. There are no cancellation fees.</p>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question" onclick="toggleFAQ(this)">
                    <span>Do you offer discounts for students?</span>
                    <i class="fas fa-chevron-down faq-icon"></i>
                </div>
                <div class="faq-answer">
                    <p>Yes! We offer a 20% student discount for verified students. Contact our support team with your student ID to get your discount code.</p>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyCictHNxtslYs9VR0hoicxlwPn_QghkgIA",
            authDomain: "edutop-7ff51.firebaseapp.com",
            projectId: "edutop-7ff51",
            storageBucket: "edutop-7ff51.firebasestorage.app",
            messagingSenderId: "79307850494",
            appId: "1:79307850494:web:b51ce51204140ec5429baf",
            measurementId: "G-GGGH590BYS"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        let selectedPlan = null;
        let selectedPlanPrice = 0;
        let selectedPaymentMethod = null;
        let currentUser = null;

        document.addEventListener('DOMContentLoaded', async function() {
            // Check auth
            onAuthStateChanged(auth, async (user) => {
                if (!user) {
                    window.location.href = "index.html";
                    return;
                }
                
                currentUser = user;
                await loadUserData();
                setupEventListeners();
            });
        });

        async function loadUserData() {
            const userDoc = await getDoc(doc(db, "users", currentUser.uid));
            if (userDoc.exists()) {
                const userData = userDoc.data();
                updateCurrentPlanUI(userData);
            }
        }

        function updateCurrentPlanUI(userData) {
            const currentPlanContainer = document.getElementById('currentPlan');
            const plan = userData.subscriptionPlan || 'Free';
            const planStatus = userData.subscriptionStatus || 'active';
            const nextBilling = userData.nextBillingDate || 'Not applicable';
            
            let planDetails = '';
            if (plan === 'Free') {
                planDetails = `
                    <div class="plan-badge">FREE PLAN</div>
                    <h2>You're on the Free Plan</h2>
                    <p>Upgrade to unlock premium features and accelerate your learning</p>
                `;
            } else if (plan === 'Premium') {
                planDetails = `
                    <div class="plan-badge">PREMIUM PLAN</div>
                    <h2>You're on the Premium Plan</h2>
                    <p>Enjoy all premium features and continue your learning journey</p>
                    <div class="plan-details">
                        <div class="plan-detail-item">
                            <div class="plan-detail-value">Active</div>
                            <div class="plan-detail-label">Status</div>
                        </div>
                        <div class="plan-detail-item">
                            <div class="plan-detail-value">${nextBilling}</div>
                            <div class="plan-detail-label">Renews on</div>
                        </div>
                    </div>
                `;
            }
            
            currentPlanContainer.innerHTML = planDetails;
            
            // Update button states
            const freeBtn = document.getElementById('freePlanBtn');
            if (plan === 'Free') {
                freeBtn.disabled = true;
                freeBtn.textContent = 'Current Plan';
            }
        }

        function selectPlan(plan, price) {
            selectedPlan = plan;
            selectedPlanPrice = price;
            
            // Show payment methods
            document.querySelector('.payment-methods').style.display = 'block';
            document.querySelector('.payment-methods').scrollIntoView({ behavior: 'smooth' });
            
            // Update transfer amount
            document.getElementById('transferAmount').textContent = `₦${price.toLocaleString()}`;
            
            alert(`Selected ${plan} plan for ₦${price.toLocaleString()}. Please select a payment method.`);
        }

        function selectPaymentMethod(method) {
            selectedPaymentMethod = method;
            
            // Update UI
            document.querySelectorAll('.method-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`.method-card[data-method="${method}"]`).classList.add('selected');
            
            // Hide all forms
            document.querySelectorAll('.payment-form').forEach(form => {
                form.style.display = 'none';
            });
            
            // Show selected form
            document.getElementById(`${method}Form`).style.display = 'block';
        }

        function cancelPayment() {
            selectedPaymentMethod = null;
            selectedPlan = null;
            
            document.querySelectorAll('.method-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            document.querySelectorAll('.payment-form').forEach(form => {
                form.style.display = 'none';
            });
        }

        async function processPayment() {
            if (!selectedPlan || !selectedPaymentMethod) {
                alert('Please select a plan and payment method first.');
                return;
            }
            
            // Validate card details
            if (selectedPaymentMethod === 'card') {
                const cardNumber = document.getElementById('cardNumber').value;
                const cardExpiry = document.getElementById('cardExpiry').value;
                const cardCVC = document.getElementById('cardCVC').value;
                const cardName = document.getElementById('cardName').value;
                
                if (!cardNumber || !cardExpiry || !cardCVC || !cardName) {
                    alert('Please fill in all card details.');
                    return;
                }
            }
            
            // In a real app, this would integrate with a payment gateway
            // For demo purposes, we'll simulate a successful payment
            
            const processingModal = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 1000;">
                    <div style="background: white; padding: 40px; border-radius: 15px; text-align: center; max-width: 400px;">
                        <div style="width: 80px; height: 80px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 30px; margin: 0 auto 20px;">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                        <h3 style="color: var(--primary); margin-bottom: 10px;">Processing Payment</h3>
                        <p>Please wait while we process your payment...</p>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', processingModal);
            
            // Simulate payment processing
            setTimeout(async () => {
                try {
                    // Update user's subscription in Firebase
                    const subscriptionData = {
                        subscriptionPlan: selectedPlan === '3months' ? 'Premium' : 'Premium',
                        subscriptionStatus: 'active',
                        subscriptionType: selectedPlan,
                        subscriptionStart: new Date().toISOString(),
                        nextBillingDate: getNextBillingDate(selectedPlan),
                        paymentHistory: {
                            amount: selectedPlanPrice,
                            method: selectedPaymentMethod,
                            date: new Date().toISOString(),
                            status: 'completed'
                        }
                    };
                    
                    await updateDoc(doc(db, "users", currentUser.uid), subscriptionData);
                    
                    // Remove processing modal
                    document.querySelector('.modal-overlay')?.remove();
                    
                    // Show success message
                    const successModal = `
                        <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 1000;">
                            <div style="background: white; padding: 40px; border-radius: 15px; text-align: center; max-width: 400px;">
                                <div style="width: 80px; height: 80px; border-radius: 50%; background: var(--success); color: white; display: flex; align-items: center; justify-content: center; font-size: 30px; margin: 0 auto 20px;">
                                    <i class="fas fa-check"></i>
                                </div>
                                <h3 style="color: var(--success); margin-bottom: 10px;">Payment Successful!</h3>
                                <p>Your subscription has been activated. You now have access to all premium features.</p>
                                <button onclick="location.reload()" style="margin-top: 20px; padding: 12px 30px; background: var(--primary); color: white; border: none; border-radius: 50px; font-weight: 600; cursor: pointer;">
                                    Continue to Dashboard
                                </button>
                            </div>
                        </div>
                    `;
                    
                    document.body.insertAdjacentHTML('beforeend', successModal);
                    
                } catch (error) {
                    console.error('Error updating subscription:', error);
                    alert('Payment failed: ' + error.message);
                }
            }, 2000);
        }

        function completeTransfer() {
            const reference = document.getElementById('transferReference').value;
            if (!reference) {
                alert('Please enter a payment reference.');
                return;
            }
            
            alert(`Please transfer ₦${selectedPlanPrice.toLocaleString()} to the account details provided. Use "${reference}" as payment reference. Once transferred, our system will automatically verify and activate your subscription within 24 hours.`);
        }

        function getNextBillingDate(planType) {
            const now = new Date();
            let nextDate = new Date(now);
            
            switch(planType) {
                case 'monthly':
                    nextDate.setMonth(nextDate.getMonth() + 1);
                    break;
                case '3months':
                    nextDate.setMonth(nextDate.getMonth() + 3);
                    break;
                default:
                    nextDate.setMonth(nextDate.getMonth() + 1);
            }
            
            return nextDate.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function toggleFAQ(element) {
            const faqItem = element.parentElement;
            const answer = faqItem.querySelector('.faq-answer');
            
            faqItem.classList.toggle('active');
            answer.classList.toggle('active');
        }

        function setupEventListeners() {
            // Card number formatting
            const cardNumberInput = document.getElementById('cardNumber');
            if (cardNumberInput) {
                cardNumberInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
                    let matches = value.match(/\d{4,16}/g);
                    let match = matches && matches[0] || '';
                    let parts = [];
                    
                    for (let i = 0, len = match.length; i < len; i += 4) {
                        parts.push(match.substring(i, i + 4));
                    }
                    
                    if (parts.length) {
                        e.target.value = parts.join(' ');
                    } else {
                        e.target.value = value;
                    }
                });
            }
            
            // Expiry date formatting
            const expiryInput = document.getElementById('cardExpiry');
            if (expiryInput) {
                expiryInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
                    if (value.length >= 2) {
                        e.target.value = value.substring(0, 2) + '/' + value.substring(2, 4);
                    }
                });
            }
        }

        // Check for dark mode preference
        const darkMode = localStorage.getItem('darkMode') === 'true';
        if (darkMode) {
            document.body.classList.add('dark-mode');
        }

    </script>
</body>
  </html>
